{% set form = hookable_metadata.context.form %}
{# @var method Sylius\Component\Core\Model\ShippingMethodInterface #}
{% set method = hookable_metadata.context.method %}

{# see \ThreeBRS\SyliusZasilkovnaPlugin\Form\Extension\ShipmentZasilkovnaExtension::buildForm #}
{% set zasilkovnaFieldName = 'zasilkovna_' ~ method.code %}
{% if form.parent.parent[zasilkovnaFieldName] is defined and form.parent.parent[zasilkovnaFieldName] %}
	{% set inputId = form.parent.parent[zasilkovnaFieldName].vars.id %}
	{% set labelId = inputId ~ '_title' %}

	{% set zasilkovnaOptions = '{}' %}
	{% if form.parent.parent[zasilkovnaFieldName].vars.attr['data-country'] is defined and form.parent.parent[zasilkovnaFieldName].vars.attr['data-country'] is not empty %}
		{% set zasilkovnaOptions = '{country: \'' ~ form.parent.parent[zasilkovnaFieldName].vars.attr['data-country'] ~ '\'}' %}
	{% endif %}

	<hr class="my-4"/>

	<div class="d-flex justify-content-center">
		<button type="button"
				id="{{ labelId }}"
				class="btn btn-outline-secondary"
				onclick="Packeta.Widget.pick(
						'{{ form.parent.parent[zasilkovnaFieldName].vars.attr['data-api-key'] }}',
						showSelectedPickupPoint.bind(this, '{{ inputId }}', '{{ labelId }}'),
				{{ zasilkovnaOptions }})"
				value="">
			{% if form.parent.parent[zasilkovnaFieldName].vars.attr['data-label'] is defined and form.parent.parent[zasilkovnaFieldName].vars.attr['data-label'] is not empty %}
				{{ form.parent.parent[zasilkovnaFieldName].vars.attr['data-label'] }}
			{% else %}
				{{ 'threebrs.shop.checkout.shippingStep.chooseZasilkovnaBranch'|trans }}
			{% endif %}
		</button>
	</div>

	<hr class="my-4"/>

	{{ form_widget(form.parent.parent[zasilkovnaFieldName]) }}
{% endif %}

{% if not form.parent.parent.zasilkovna.isRendered %}
	{# TODO needed? #}
	{{ form_widget(form.parent.parent.zasilkovna) }}
{% endif %}
